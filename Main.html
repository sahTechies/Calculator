<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Basic Calculator</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --key: #1f2937;
      --key-text: #e5e7eb;
      --accent: #22c55e;
      --op: #2563eb;
      --danger: #ef4444;
      --display: #0b1220;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: radial-gradient(1200px 600px at 10% 10%, #1e293b 0%, #0b1220 40%, #020617 100%);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color: #e5e7eb;
    }

    .calc {
      width: min(92vw, 380px);
      background: linear-gradient(180deg, #0b1220, #0a1020 60%, #070c18);
      border: 1px solid #1f2937;
      border-radius: 16px;
      box-shadow:
        0 10px 30px rgba(0,0,0,0.6),
        inset 0 0 0 1px rgba(255,255,255,0.04);
      overflow: hidden;
    }

    .display {
      padding: 18px 16px 10px 16px;
      background: linear-gradient(180deg, var(--display), #0a1426);
      border-bottom: 1px solid #1f2937;
    }

    .expr, .result {
      width: 100%;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      direction: ltr;
    }

    .expr {
      min-height: 28px;
      font-size: 18px;
      color: #a5b4fc;
      opacity: 0.9;
      letter-spacing: 0.2px;
    }

    .result {
      min-height: 44px;
      font-size: 32px;
      line-height: 1.2;
      font-weight: 600;
      color: #f8fafc;
      margin-top: 6px;
    }

    .keys {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      padding: 14px;
      background: linear-gradient(180deg, #0b1220, #0b1220);
    }

    button.key {
      appearance: none;
      border: 1px solid #263142;
      background: linear-gradient(180deg, #101827, #0f1a2a);
      color: var(--key-text);
      height: 56px;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.2px;
      cursor: pointer;
      transition: transform 0.02s ease, background 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease;
      box-shadow:
        0 2px 6px rgba(0,0,0,0.35),
        inset 0 0 0 1px rgba(255,255,255,0.04);
    }

    button.key:hover {
      border-color: #324257;
      background: linear-gradient(180deg, #122138, #112036);
    }

    button.key:active {
      transform: translateY(1px);
      box-shadow:
        0 1px 3px rgba(0,0,0,0.5),
        inset 0 0 0 1px rgba(255,255,255,0.03);
    }

    .key.op {
      background: linear-gradient(180deg, rgba(37,99,235,0.18), rgba(17,24,39,0.8));
      border-color: rgba(37,99,235,0.35);
      color: #cfe1ff;
    }

    .key.op:hover {
      background: linear-gradient(180deg, rgba(37,99,235,0.28), rgba(17,24,39,0.9));
      border-color: rgba(37,99,235,0.55);
    }

    .key.equals {
      background: linear-gradient(180deg, rgba(34,197,94,0.25), rgba(17,24,39,0.85));
      border-color: rgba(34,197,94,0.45);
      color: #d5ffe5;
      grid-column: 4 / 5;
      grid-row: 4 / span 2;
      height: 122px;
      font-size: 20px;
    }

    .key.equals:hover {
      background: linear-gradient(180deg, rgba(34,197,94,0.35), rgba(17,24,39,0.9));
      border-color: rgba(34,197,94,0.7);
    }

    .key.clear {
      color: #ffe1e1;
      background: linear-gradient(180deg, rgba(239,68,68,0.18), rgba(17,24,39,0.8));
      border-color: rgba(239,68,68,0.35);
    }

    .key.clear:hover {
      background: linear-gradient(180deg, rgba(239,68,68,0.28), rgba(17,24,39,0.9));
      border-color: rgba(239,68,68,0.55);
    }

    .key.wide {
      grid-column: span 2;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>
<body>
  <main class="calc" role="application" aria-label="Basic calculator">
    <section class="display" aria-live="polite" aria-atomic="true">
      <div id="expression" class="expr">0</div>
      <div id="result" class="result">0</div>
    </section>

    <section class="keys">
      <!-- Row 1 -->
      <button class="key clear" data-action="clear" aria-label="Clear">C</button>
      <button class="key" data-action="backspace" aria-label="Backspace">⌫</button>
      <button class="key op" data-op="÷" aria-label="Divide">÷</button>
      <button class="key op" data-op="×" aria-label="Multiply">×</button>

      <!-- Row 2 -->
      <button class="key" data-num="7">7</button>
      <button class="key" data-num="8">8</button>
      <button class="key" data-num="9">9</button>
      <button class="key op" data-op="+">+</button>

      <!-- Row 3 -->
      <button class="key" data-num="4">4</button>
      <button class="key" data-num="5">5</button>
      <button class="key" data-num="6">6</button>
      <button class="key op" data-op="−" aria-label="Minus">−</button>

      <!-- Row 4 -->
      <button class="key" data-num="1">1</button>
      <button class="key" data-num="2">2</button>
      <button class="key" data-num="3">3</button>
      <button class="key equals" data-action="equals" aria-label="Equals">=</button>

      <!-- Row 5 -->
      <button class="key wide" data-num="0">0</button>
      <button class="key" data-num="." aria-label="Decimal point">.</button>
    </section>
  </main>

  <script>
    (function () {
      const exprEl = document.getElementById('expression');
      const resEl = document.getElementById('result');
      const keys = document.querySelector('.keys');

      let expr = '0';
      let lastWasEquals = false;

      function updateDisplay() {
        exprEl.textContent = expr || '0';
      }

      function sanitize(input) {
        // Map pretty ops to JS ops
        return input
          .replace(/÷/g, '/')
          .replace(/×/g, '*')
          .replace(/−/g, '-')
          // Prevent leading multiple zeros like 0001
          .replace(/(^|[^0-9])0+(\d)/g, '$1$2');
      }

      function computeSafe(input) {
        const safe = sanitize(input);
        // Allow only digits, + - * / . and spaces
        if (!/^[\d+\-*/.\s]+$/.test(safe)) return 'Error';
        // Prevent invalid sequences like multiple operators
        if (/[*\/+\-]{2,}/.test(safe)) return 'Error';
        // Disallow starting/ending with operator (except leading minus for negative)
        if (/^[*/+]/.test(safe) || /[*\/+\-]$/.test(safe)) return 'Error';

        try {
          const value = Function('return (' + safe + ')')();
          if (!isFinite(value)) return 'Error';
          // Round to avoid floating-point artifacts
          return Number(Math.round((value + Number.EPSILON) * 1e12) / 1e12).toString();
        } catch {
          return 'Error';
        }
      }

      function appendNumber(n) {
        if (lastWasEquals) {
          expr = (n === '.') ? '0.' : n;
          lastWasEquals = false;
          return;
        }
        if (expr === '0' && n !== '.') {
          expr = n;
        } else {
          // Prevent multiple decimals in the current number token
          if (n === '.') {
            const lastToken = expr.split(/[+\-×÷]/).pop();
            if (lastToken.includes('.')) return;
          }
          expr += n;
        }
      }

      function appendOp(op) {
        lastWasEquals = false;
        if (expr === '' || expr === '0') {
          // Allow starting with minus for negatives
          if (op === '−') expr = '−';
          return;
        }
        // Replace trailing operator if present
        if (/[+\-×÷]$/.test(expr)) {
          // Allow changing operator directly
          expr = expr.slice(0, -1) + op;
        } else {
          expr += op;
        }
      }

      function clearAll() {
        expr = '0';
        resEl.textContent = '0';
        lastWasEquals = false;
      }

      function backspace() {
        if (lastWasEquals) {
          clearAll();
          return;
        }
        if (expr.length <= 1) {
          expr = '0';
        } else {
          expr = expr.slice(0, -1);
          // Avoid empty expression
          if (expr === '' || expr === '−') expr = '0';
        }
      }

      function equals() {
        const out = computeSafe(expr);
        resEl.textContent = out;
        lastWasEquals = true;
      }

      // Click handling
      keys.addEventListener('click', (e) => {
        const btn = e.target.closest('button.key');
        if (!btn) return;

        const n = btn.getAttribute('data-num');
        const op = btn.getAttribute('data-op');
        const action = btn.getAttribute('data-action');

        if (n !== null) {
          appendNumber(n);
          updateDisplay();
          return;
        }
        if (op !== null) {
          appendOp(op);
          updateDisplay();
          return;
        }
        if (action === 'clear') {
          clearAll();
          updateDisplay();
          return;
        }
        if (action === 'backspace') {
          backspace();
          updateDisplay();
          return;
        }
        if (action === 'equals') {
          equals();
          return;
        }
      });

      // Keyboard support
      window.addEventListener('keydown', (e) => {
        const { key } = e;
        if ((key >= '0' && key <= '9') || key === '.') {
          appendNumber(key);
          updateDisplay();
          return;
        }
        if (key === '+' || key === '-' || key === '*' || key === '/') {
          const pretty = key === '*' ? '×' : key === '/' ? '÷' : key === '-' ? '−' : '+';
          appendOp(pretty);
          updateDisplay();
          return;
        }
        if (key === 'Enter' || key === '=') {
          e.preventDefault();
          equals();
          return;
        }
        if (key === 'Backspace') {
          backspace();
          updateDisplay();
          return;
        }
        if (key.toLowerCase() === 'c' || key === 'Escape') {
          clearAll();
          updateDisplay();
        }
      });

      // Initial paint
      updateDisplay();
    })();
  </script>
</body>
</html>
